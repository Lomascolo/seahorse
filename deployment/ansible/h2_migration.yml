# Copyright (c) 2016, CodiLime Inc.

---
- name: Create download dir
  hosts: localhost
  vars_files:
    - vars/deployment.yml
  tasks:
    - include: tasks/create_download_dir.yml

- name: Download H2 package
  hosts: localhost
  vars_files:
    - vars/deployment.yml
    - vars/artifacts.yml
    - vars/h2.yml
  tasks:
    - include: tasks/download_h2.yml

- name: Perform H2 database migration
  hosts: master
  user: ubuntu
  sudo: yes
  vars_files:
    - vars/deployment.yml
    - vars/h2.yml
  roles:
    - { role: h2_migration,
        sql_dir: "{{ wm_sql_dir }}",
        database: "{{ wm_install_dir }}/workflowmanager",
        module: "workflowmanager"
      }
    - { role: h2_migration,
        sql_dir: "{{ sm_sql_dir }}",
        database: "{{ sm_install_dir }}/sessionmanager",
        module: "sessionmanager"
      }
